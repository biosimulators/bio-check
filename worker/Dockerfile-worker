# Worker container

# TODO: Read in from BASE_VERSION.txt aka the most recent stable release
FROM ghcr.io/biosimulators/bio-check-base:latest

WORKDIR /app

COPY . /app/worker

ENV PACKAGE_DIR="/app/worker"

ENV PYTHONPATH=$PYTHONPATH:$PACKAGE_DIR

RUN pipenv run uninstall biosimulators-utils -y \
    && echo "\nbiosimulators-utils[logging]==0.1.187" >> /app/assets/requirements.base.txt \
    && pipenv run install biosimulators-utils'[logging]'==0.1.187 \
    && pipenv run pip install -e /app/worker

# && pip install --no-cache-dir -r /app/assets/requirements.base.txt

# TODO: For CMD, run a main python file that is a while loop checking for jobs

WORKDIR /app/worker

CMD ["pipenv", "run", "python3", "main.py"]