FROM python:3.11-slim-bullseye
LABEL authors="alexanderpatrie"

ENV DEBIAN_FRONTEND=noninteractive

RUN mkdir /app

WORKDIR /app

RUN mkdir /app/bio_check && touch /app/bio_check/__init__.py

COPY pyproject.toml /app/pyproject.toml
COPY poetry.lock /app/poetry.lock

COPY bio_check/io.py /app/bio_check/io.py

ENV CRYPTOGRAPHY_DONT_BUILD_RUST=1

# hdf5 deps
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc \
    libc-dev \
    linux-headers-arm64 \
    libjpeg-dev \
    zlib1g-dev \
    libmariadb-dev \
    libffi-dev \
    libopenblas-dev \
    libgfortran5 \
    liblapack-dev \
    build-essential \
    libssl-dev \
    libhdf5-dev \
    pkg-config \
    wget \
    build-essential \
    cmake \
    swig \
    libbz2-dev \
    && apt-get clean  \
    && rm -rf /var/lib/apt/lists/*  \
    && apt-get autoremove -y

ENV PYTHONUNBUFFERED 1

RUN pip install --upgrade pip  \
    && pip install poetry \
    && poetry config virtualenvs.in-project true \
    && poetry update \
    && poetry install --no-cache --no-root --no-interaction

# RUN groupadd -r user && useradd -r -g user user
# USER user
# RUN pip install --upgrade pip && pip install --no-cache-dir -r ./assets/requirements.base.txt

