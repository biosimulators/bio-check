# This base image is already configured for many purposes
FROM ghcr.io/biosimulators/biosimulators:latest

LABEL authors="alexanderpatrie"

# TODO: make base version more nuanceddo
ENV PACKAGE_ROOT=ghcr.io/biosimulators/bio-check
ENV BASE_VERSION=0.0.0
ENV BASE_IMAGE="$PACKAGE_ROOT-base:$BASE_VERSION"
ENV DEBIAN_FRONTEND=noninteractive

WORKDIR /app

RUN mkdir /app/data

# copy deps
COPY ./assets/requirements.base.txt ./assets/scripts/remove-pkgs.sh ./assets/dropped.txt /app/assets/

RUN chmod +x /app/assets/remove-pkgs.sh \
    && pip install --upgrade pip  \
    && /app/assets/remove-pkgs.sh \
    && pip install --no-cache-dir -r /app/assets/requirements.base.txt \
    && rm /app/assets/remove-pkgs.sh

# yes | docker system prune -a && yes | docker buildx prune -a \
#   && docker build -f ./Dockerfile-base -t "$PKG_ROOT"-base:"$base_version" . \
#   && docker tag "$PKG_ROOT"-base:"$base_version" "$PKG_ROOT"-base:latest \
#   && docker build -f ./api/Dockerfile-api -t ghcr.io/biosimulators/bio-check-api:0.0.0 ./api \
#   && docker build -f ./worker/Dockerfile-worker -t ghcr.io/biosimulators/bio-check-worker:0.0.0 ./worker


# docker run --name worker --platform linux/amd64 -it ghcr.io/biosimulators/bio-check-worker:0.0.0 \
#   && docker run --name api --platform linux/amd64 -it ghcr.io/biosimulators/bio-check-api:0.0.0